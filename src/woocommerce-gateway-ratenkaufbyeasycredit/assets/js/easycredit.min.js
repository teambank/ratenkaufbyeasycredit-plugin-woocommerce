!function(e){"object"==typeof module&&"object"==typeof module.exports?e(require("jquery"),window,document):e(jQuery,window,document)}(function(o,e,t,i){var a=[],n=function(){return a.length?a[a.length-1]:null},s=function(){var e,t=!1;for(e=a.length-1;0<=e;e--)a[e].$blocker&&(a[e].$blocker.toggleClass("easycreditmodal-current",!t).toggleClass("easycreditmodal-behind",t),t=!0)};o.easycreditmodal=function(i,e){var s,t;if(this.$body=o("body"),this.options=o.extend({},o.easycreditmodal.defaults,e),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting)for(;o.easycreditmodal.isActive();)o.easycreditmodal.close();if(a.push(this),i.is("a"))if(t=i.attr("href"),this.anchor=i,/^#/.test(t)){if(this.$elm=o(t),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=o("<div>"),this.$body.append(this.$elm),s=function(e,t){t.elm.remove()},this.showSpinner(),i.trigger(o.easycreditmodal.AJAX_SEND),o.get(t).done(function(e){if(o.easycreditmodal.isActive()){i.trigger(o.easycreditmodal.AJAX_SUCCESS);var t=n();t.$elm.empty().append(e).on(o.easycreditmodal.CLOSE,s),t.hideSpinner(),t.open(),i.trigger(o.easycreditmodal.AJAX_COMPLETE)}}).fail(function(){i.trigger(o.easycreditmodal.AJAX_FAIL),n().hideSpinner(),a.pop(),i.trigger(o.easycreditmodal.AJAX_COMPLETE)});else this.$elm=i,this.anchor=i,this.$body.append(this.$elm),this.open()},o.easycreditmodal.prototype={constructor:o.easycreditmodal,open:function(){var e=this;this.block(),this.anchor.blur(),this.options.doFade?setTimeout(function(){e.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),o(t).off("keydown.easycreditmodal").on("keydown.easycreditmodal",function(e){var t=n();27===e.which&&t.options.escapeClose&&t.close()}),this.options.clickClose&&this.$blocker.click(function(e){e.target===this&&o.easycreditmodal.close()})},close:function(){a.pop(),this.unblock(),this.hide(),this.$elm.remove(),o.easycreditmodal.isActive()||o(t).off("keydown.easycreditmodal")},block:function(){this.$elm.trigger(o.easycreditmodal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=o('<div class="'+this.options.blockerClass+' easycreditmodal-blocker easycreditmodal-current"></div>').appendTo(this.$body),s(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(o.easycreditmodal.BLOCK,[this._ctx()])},unblock:function(e){!e&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,s(),o.easycreditmodal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger(o.easycreditmodal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=o('<a href="#close-easycreditmodal" rel="easycreditmodal:close" class="close-easycreditmodal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css({opacity:0,display:"inline-block"}).animate({opacity:1},this.options.fadeDuration):this.$elm.css("display","inline-block"),this.$elm.trigger(o.easycreditmodal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(o.easycreditmodal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var e=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){e.$elm.trigger(o.easycreditmodal.AFTER_CLOSE,[e._ctx()])}):this.$elm.hide(0,function(){e.$elm.trigger(o.easycreditmodal.AFTER_CLOSE,[e._ctx()])}),this.$elm.trigger(o.easycreditmodal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||o('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$elm:this.$elm,$blocker:this.$blocker,options:this.options}}},o.easycreditmodal.close=function(e){if(o.easycreditmodal.isActive()){e&&e.preventDefault();var t=n();return t.close(),t.$elm}},o.easycreditmodal.isActive=function(){return 0<a.length},o.easycreditmodal.getCurrent=n,o.easycreditmodal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"easycreditmodal",blockerClass:"jquery-easycreditmodal",spinnerHtml:'<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div>',showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},o.easycreditmodal.BEFORE_BLOCK="modal:before-block",o.easycreditmodal.BLOCK="modal:block",o.easycreditmodal.BEFORE_OPEN="modal:before-open",o.easycreditmodal.OPEN="modal:open",o.easycreditmodal.BEFORE_CLOSE="modal:before-close",o.easycreditmodal.CLOSE="modal:close",o.easycreditmodal.AFTER_CLOSE="modal:after-close",o.easycreditmodal.AJAX_SEND="modal:ajax:send",o.easycreditmodal.AJAX_SUCCESS="modal:ajax:success",o.easycreditmodal.AJAX_FAIL="modal:ajax:fail",o.easycreditmodal.AJAX_COMPLETE="modal:ajax:complete",o.fn.easycreditmodal=function(e){return 1===this.length&&new o.easycreditmodal(this,e),this},o(t).on("click.easycreditmodal",'a[rel~="easycreditmodal:close"]',o.easycreditmodal.close),o(t).on("click.easycreditmodal",'a[rel~="easycreditmodal:open"]',function(e){e.preventDefault(),o(this).easycreditmodal()})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(n){var e={template:['<div class="easycredit-modal">','<div class="easycredit-embed-responsive"></div>',"</div>"].join("\n"),handleModal:function(e,t){var i=n(this.template);i.find(".easycredit-embed-responsive").append(t).css({height:"900px","max-height":"900px"}),n(e).append(i),i.easycreditmodal()},init:function(e,t){this.handleModal(e,t)}},l={hostname:"https://ratenkauf.easycredit.de",endpoint:"/ratenkauf-ws/rest/v1/modellrechnung/guenstigsterRatenplan",iframeSrc:"/ratenkauf/content/intern/paymentPageBeispielrechnung.jsf",modal:e.init.bind(e),webshopId:null,amount:null,debug:!1,currencySymbol:"&euro;",installmentTemplate:"%amount% %currency_symbol% / Monat",widgetTemplate:['<div class="easycredit-widget">','<span class="easycredit-suffix">%suffix% </span>','<span class="easycredit-rate">%installmentTemplate%</span>',"<br />",'<a class="easycredit-link">%link_text%</a>',"</div>"].join("\n"),suffix:"Finanzieren ab",linkText:"mehr Infos zum Ratenkauf"},d=function(e,i){return e.replace(/%(\w*)%/g,function(e,t){return i.hasOwnProperty(t)?i[t]:""})},r=function(e,t){var i,s='<iframe class="embed-responsive-item" src="'+[(i=t).hostname+i.iframeSrc,n.param({shopKennung:i.webshopId,bestellwert:i.amount})].join("?")+'"></iframe>';t.modal(e,s)},s=function(o){o=n.extend({},l,o);var a=n(this);if(n(this).data("easycredit-amount")&&(o.amount=n(this).data("easycredit-amount")),isNaN(o.amount)||o.amount<200||1e4<o.amount)o.debug&&console.log(o.amount+" is not within allowed range");else{if(null==o.webshopId||""==o.webshopId)throw new Error("webshopId must be set for easycredit widget");var e,t,i,s=[(e=o).hostname+e.endpoint,n.param({webshopId:e.webshopId,finanzierungsbetrag:e.amount})].join("?");t=s,i=function(e){if(e&&!(0<e.wsMessages.messages.length)){var t,i={number_of_installments:e.anzahlRaten,amount:(t=e.betragRate,Number(Math.round(t+"e2")+"e-2").toFixed(2).replace(".",",")),currency_symbol:o.currencySymbol,suffix:o.suffix,link_text:o.linkText};i.installmentTemplate=d(o.installmentTemplate,i);var s=n(d(o.widgetTemplate,i));n(a).append(s),s.find("a").click(r.bind(this,a,o))}},n.ajax({type:"GET",url:t,contentType:"application/json; charset=utf-8",dataType:"jsonp",success:i})}};n.fn.rkPaymentPage=function(i){return this.each(function(e,t){s.apply(t,[i])})},window.rkPlugin={},window.rkPlugin.anzeige=function(e,t){n("#"+e).rkPaymentPage(t)}}),jQuery(function(e){var t=e("meta[name=easycredit-widget-selector]").attr("content");e(t).rkPaymentPage({webshopId:e("meta[name=easycredit-api-key]").attr("content"),amount:e("meta[name=easycredit-widget-price]").attr("content")}),e(".woocommerce-checkout").on("change","#billing_company",function(){e(this).trigger("update_checkout")})});
//# sourceMappingURL=easycredit.min.js.map